<template>
  <div id="left-nav">
    <el-dropdown @command="select" style="display: block; margin: 0 auto" placement="bottom" trigger="click">
      <div class="el-dropdown-link btn new">
        <button>新建</button>
      </div>
      <el-dropdown-menu slot="dropdown">
        <el-dropdown-item command="blankFile" class="item">
          <svg t="1653197407782" class="icon" viewBox="0 0 1228 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="26439" width="20" height="20"><path d="M1228.8 341.333333v-47.854933c0-122.4704-57.5488-185.275733-169.710933-185.275733H545.860267c-37.205333 0-59.1872-9.966933-86.8352-35.498667L427.485867 44.2368C391.304533 11.195733 363.7248 0 310.135467 0h-159.061334C55.9104 0 0 60.279467 0 180.906667V341.333333h1228.8z m-155.101867 682.666667C1171.8656 1024 1228.8 966.8608 1228.8 854.8352V409.6H0v445.2352C0 966.8608 57.5488 1024 170.325333 1024h903.3728z" fill="#EDA023" p-id="26440"></path></svg>
          <span>新建文件</span>
        </el-dropdown-item>
        <el-dropdown-item command="import" class="item">
          <svg t="1653197531044" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="41811" width="20" height="20"><path d="M947.26 577.96a54.296 54.296 0 0 0-54.296 54.288v230.376c0 0.504-0.56 1.208-1.608 1.208H110.5c-1.056 0-1.616-0.704-1.616-1.208V161.376c0-0.512 0.56-1.208 1.616-1.208h191.4a54.288 54.288 0 1 0 0-108.568H110.5C49.74 51.6 0.316 100.84 0.316 161.384v701.248c0 60.528 49.424 109.792 110.184 109.792h780.856c60.752 0 110.184-49.256 110.184-109.792V632.248a54.288 54.288 0 0 0-54.28-54.288z" fill="#f4ea2a" p-id="41812"></path><path d="M1023.356 100.008a54.24 54.24 0 0 0-59.84-48.104c-5.344 0.592-132.504 15.096-267.216 89.432-141.632 78.16-238.824 193.08-286.072 336.552L350.692 305.76a54.28 54.28 0 1 0-102.592 35.496l106.752 308.616a54.312 54.312 0 0 0 69.088 33.552l0.632-0.224 309.424-111.584a54.296 54.296 0 0 0-36.832-102.144l-191.896 69.2c34.664-129.656 115.224-230.552 240.392-300.552 115.944-64.848 228.584-78.16 229.72-78.288a54.272 54.272 0 0 0 47.976-59.824z" fill="#f4ea2a" p-id="41813"></path></svg>
          <span>导入</span>
        </el-dropdown-item>
        <el-dropdown-item command="flowChart" class="item">
          <svg t="1653197588790" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="42690" width="20" height="20"><path d="M512 163.584h140.8V263.04H561.792v497.792H652.8v99.52H462.208V163.584H512zM716.8 64h170.688a64 64 0 0 1 64 64v120.896a64 64 0 0 1-64 64H716.8a64 64 0 0 1-64-64V128a64 64 0 0 1 64-64zM299.84 346.048L420.48 466.752a64 64 0 0 1 0 90.496l-120.64 120.704a64 64 0 0 1-90.496 0L88.64 557.248a64 64 0 0 1 0-90.496L209.28 346.048a64 64 0 0 1 90.496 0z m416.96 365.056h170.688a64 64 0 0 1 64 64V896a64 64 0 0 1-64 64H716.8a64 64 0 0 1-64-64v-120.896a64 64 0 0 1 64-64z" fill="#f4ea2a" p-id="42691"></path></svg>
          <span>流程图</span>
        </el-dropdown-item>
        <el-dropdown-item command="ERChart" class="item">
          <svg t="1653197621360" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="44923" width="20" height="20"><path d="M727.103602 303.129441c-81.792795 0-148.448199-66.528199-148.448198-148.448199C578.655404 72.888447 645.183602 6.233043 727.103602 6.233043s148.448199 66.528199 148.448199 148.448199c0 81.92-66.528199 148.448199-148.448199 148.448199z m0-245.887205c-53.807702 0-97.566211 43.758509-97.566211 97.566211s43.758509 97.566211 97.566211 97.566211 97.566211-43.758509 97.566212-97.566211-43.758509-97.566211-97.566212-97.566211zM847.948323 1024c-81.792795 0-148.448199-66.528199-148.448199-148.448199 0-81.792795 66.528199-148.448199 148.448199-148.448199 81.792795 0 148.448199 66.528199 148.448199 148.448199 0 81.792795-66.655404 148.448199-148.448199 148.448199z m0-246.01441c-53.807702 0-97.566211 43.758509-97.566211 97.566211s43.758509 97.566211 97.566211 97.566211 97.566211-43.758509 97.566211-97.566211-43.758509-97.566211-97.566211-97.566211zM165.239255 803.426584c-81.792795 0-148.448199-66.528199-148.448199-148.448199S83.319255 506.530186 165.239255 506.530186c81.792795 0 148.448199 66.528199 148.448198 148.448199s-66.528199 148.448199-148.448198 148.448199z m0-245.887205c-53.807702 0-97.566211 43.758509-97.566212 97.566211s43.758509 97.566211 97.566212 97.566211 97.566211-43.758509 97.566211-97.566211-43.758509-97.566211-97.566211-97.566211zM576.365714 728.884472c-106.343354 0-192.715528-86.499379-192.715528-192.715528S470.149565 343.453416 576.365714 343.453416c106.343354 0 192.715528 86.499379 192.715528 192.715528S682.709068 728.884472 576.365714 728.884472z m0-334.676273c-78.231056 0-141.83354 63.602484-141.83354 141.83354s63.602484 141.83354 141.83354 141.833541 141.83354-63.602484 141.833541-141.833541-63.602484-141.83354-141.833541-141.83354z" p-id="44924" fill="#1296db"></path><path d="M613.344199 372.761441l32.310062-102.65441 48.528696 15.264596-32.310063 102.65441zM664.83677 672.125615l42.028522-28.697441 83.917118 122.918161-42.015801 28.697441zM270.768497 603.040596l136.656298-45.412174 16.040547 48.287007-136.643578 45.412173z" p-id="44925" fill="#1296db"></path></svg>
          <span>E-R图</span>
        </el-dropdown-item>
        <el-dropdown-item command="UMLChart" class="item">
          <svg t="1653197661126" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="45814" width="20" height="20"><path d="M338.463047 365.281825h343.2399c19.950319 0 36.124432-16.174112 36.124432-36.124432V36.124432c0-19.950319-16.174112-36.124432-36.124432-36.124432H338.463047c-19.950319 0-36.124432 16.174112-36.124432 36.124432v293.032961c0 19.950319 16.172908 36.124432 36.124432 36.124432z m36.124431-293.032962h270.991037v220.784098H374.587478V72.248863zM987.04591 658.718175H643.804806c-19.950319 0-36.124432 16.174112-36.124432 36.124432v293.032961c0 19.950319 16.174112 36.124432 36.124432 36.124432h343.241104c19.950319 0 36.124432-16.174112 36.124432-36.124432V694.842607c0-19.950319-16.174112-36.124432-36.124432-36.124432z m-36.124431 293.032962H679.929238V730.967039h270.992241v220.784098zM380.195194 658.718175H36.95409c-19.950319 0-36.124432 16.174112-36.124432 36.124432v293.032961c0 19.950319 16.174112 36.124432 36.124432 36.124432h343.241104c19.950319 0 36.124432-16.174112 36.124432-36.124432V694.842607c0-19.950319-16.174112-36.124432-36.124432-36.124432z m-36.124432 293.032962H73.078521V730.967039h270.992241v220.784098zM629.768056 562.238247a36.017263 36.017263 0 0 0 14.0223 2.84781c14.090937 0 27.481059-8.297782 33.300705-22.097315l19.21579-45.567359 89.601836 126.29583c7.04306 9.928198 18.182631 15.225244 29.49319 15.225244a35.958259 35.958259 0 0 0 20.871493-6.663753c16.272852-11.544164 20.10445-34.093035 8.560286-50.364683l-82.057851-115.66441 49.567537 4.247029c19.8576 1.697848 37.371929-13.030083 39.075798-32.909357 1.702665-19.878071-13.030083-37.373133-32.909357-39.077002l-126.573989-10.844554a35.857111 35.857111 0 0 0-5.836504-0.124028h-0.007224c-0.799554 0.048166-1.593087 0.125231-2.384213 0.22638l-0.291404 0.036125c-0.788717 0.107169-1.571413 0.236013-2.349292 0.393756-0.08429 0.016858-0.167377 0.038533-0.251667 0.055391-0.668302 0.140885-1.330583 0.302241-1.988048 0.480455a36.572375 36.572375 0 0 0-2.667187 0.823637c-0.090311 0.032512-0.178214 0.068636-0.268525 0.102352a36.771059 36.771059 0 0 0-6.813068 3.322244 36.076266 36.076266 0 0 0-3.877355 2.792418l-0.149315 0.125232a36.037733 36.037733 0 0 0-3.597993 3.453496l-0.024083 0.026491a35.769208 35.769208 0 0 0-1.634028 1.941086l-0.016859 0.021675a35.386289 35.386289 0 0 0-1.512409 2.084379l-0.027695 0.042145c-0.435901 0.65024-0.848924 1.319746-1.245089 2.004906-0.038533 0.066228-0.081882 0.126436-0.119211 0.192664-0.027695 0.048166-0.04937 0.097536-0.075861 0.144498a35.947422 35.947422 0 0 0-1.122266 2.137362c-0.036124 0.074657-0.067432 0.151723-0.102352 0.22638-0.216747 0.45878-0.429881 0.919969-0.628565 1.391995l-44.424622 105.346067c-7.753507 18.386132 0.863374 39.573111 19.247097 47.325414zM405.389577 404.282965c-0.115598-0.18303-0.24083-0.357632-0.36004-0.538254a35.918522 35.918522 0 0 0-1.671357-2.345679l-0.055391-0.073454a36.006425 36.006425 0 0 0-1.553351-1.844754c-0.079474-0.089107-0.161356-0.175806-0.242033-0.264912a35.499479 35.499479 0 0 0-1.648478-1.69544 35.824599 35.824599 0 0 0-3.889398-3.234341l-0.027695-0.020471a35.96428 35.96428 0 0 0-4.195251-2.593734l-0.204705-0.108373a36.306258 36.306258 0 0 0-6.810659-2.704516c-0.066228-0.019266-0.131252-0.040941-0.197481-0.059003a36.780692 36.780692 0 0 0-2.179507-0.526213c-0.196276-0.042145-0.393756-0.079474-0.591236-0.118006a35.70298 35.70298 0 0 0-1.953128-0.327528c-0.104761-0.01445-0.208318-0.033716-0.314283-0.046962a36.17621 36.17621 0 0 0-2.309555-0.219155c-0.143294-0.009633-0.286587-0.015654-0.429881-0.022879a37.011889 37.011889 0 0 0-2.342067-0.054186h-0.012041c-0.848924 0.009633-1.699052 0.055391-2.549181 0.125231l-0.068637 0.003612-127.196532 10.897537c-19.878071 1.703869-34.612022 19.197727-32.909357 39.077002 1.703869 19.878071 19.206156 34.609614 39.077002 32.909358l49.566332-4.247029-82.05785 115.664409c-11.544164 16.271648-7.711362 38.820518 8.560286 50.364683a35.958259 35.958259 0 0 0 20.871492 6.663753c11.31056 0 22.451334-5.297046 29.494395-15.225243l95.971777-135.27516 37.880079 59.831692c6.875684 10.862617 18.58602 16.80629 30.555249 16.80629a35.967893 35.967893 0 0 0 19.289242-5.606512c16.856864-10.672361 21.870935-32.988831 11.198574-49.845695l-66.695334-105.346068z" fill="#13227a" p-id="45815"></path></svg>
          <span>UML用例图</span>
        </el-dropdown-item>
      </el-dropdown-menu>
    </el-dropdown>
    <a class="item diagrams" @click="toPage('diagrams')">
      <svg t="1649855878183" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8700" width="20" height="20"><path d="M459.704448 833.996598" p-id="8701" :fill="active === 'diagrams' ? '#555555' : '#888888'"></path><path d="M947.859367 456.556247 589.952908 156.258856c-21.905916-18.380626-49.721425-28.515451-78.323856-28.52466l-0.044002 0c-28.585035 0-56.395428 10.110265-78.305437 28.467355l-358.517373 300.340369c-12.852726 10.767228-14.544251 29.912263-3.777023 42.764989 6.007831 7.16519 14.616906 10.859325 23.288402 10.859325 6.875594 0 13.793144-2.322905 19.47761-7.082302l18.520819-15.519462 0 325.160661c0 21.898753 8.527211 42.488697 24.01188 57.973366 15.484669 15.482623 36.071543 24.010857 57.974389 24.010857l184.665837 0 0-0.019443c66.174142 0 60.780295-60.693314 60.780295-60.693314L459.704448 629.535927c0-4.14746 1.616824-8.048303 4.552689-10.983145 2.930749-2.934842 6.833639-4.547573 10.985192-4.547573l72.124667 0c4.15053 0 8.04728 1.612731 10.984169 4.547573 2.934842 2.934842 4.551666 6.836709 4.551666 10.983145l0 204.460672-0.010233 0c0 0-5.393847 60.693314 60.780295 60.693314l0 0.019443 184.678116 0c21.895683 0 42.484603-8.528234 57.969273-24.010857 15.488763-15.485693 24.015973-36.074613 24.015973-57.973366L890.336256 487.539912l18.501376 15.527648c12.844539 10.772344 31.993668 9.101285 42.770106-3.746324C962.379059 486.47772 960.702883 467.333708 947.859367 456.556247zM829.619406 812.724109c0 5.681396-2.210341 11.026124-6.226818 15.043624-4.0175 4.0175-9.357112 6.228865-15.040555 6.228865L623.614565 833.996598 623.614565 629.535927c0-20.364817-7.931646-39.513946-22.330588-53.91391-14.400988-14.402011-33.55114-22.334681-53.915957-22.334681l-72.124667 0c-20.369933 0-39.521109 7.93267-53.918004 22.334681-14.397918 14.398942-22.330588 33.54807-22.330588 53.91391l0 204.460672L214.257294 833.996598c-5.683443 0-11.023054-2.211365-15.040555-6.228865-4.022617-4.0175-6.232958-9.362228-6.232958-15.040555l0-376.024096 279.278681-233.966683c11.003612-9.216919 24.966625-14.292518 39.321564-14.292518l0.020466 0c14.359033 0.005117 28.328185 5.094018 39.326681 14.32117l278.688233 233.836723L829.619406 812.724109z" p-id="8702" :fill="active === 'diagrams' ? '#555555' : '#888888'"></path></svg>
      <span :class="{'active': active === 'diagrams'}">我的文件</span>
      </a>
    <a class="item history" @click="toPage('history')">
      <svg t="1649855852412" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7766" width="20" height="20"><path d="M512 832c-176.448 0-320-143.552-320-320S335.552 192 512 192s320 143.552 320 320-143.552 320-320 320m0-704C300.256 128 128 300.256 128 512s172.256 384 384 384 384-172.256 384-384S723.744 128 512 128" p-id="7767" :fill="active === 'history' ? '#555555' : '#888888'"></path><path d="M544 505.856V320a32 32 0 0 0-64 0v199.104c0 8.48 3.36 16.64 9.376 22.624l107.296 107.296a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0-45.248L544 505.856z" p-id="7768" :fill="active === 'history' ? '#555555' : '#888888'"></path></svg>
      <span :class="{'active': active === 'history'}">最近修改</span>
      </a>
    <a class="item trash" @click="toPage('trash')">
      <svg t="1649855792891" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5892" width="20" height="20"><path d="M736 352.032L736.096 800h-0.128L288 799.968 288.032 352 736 352.032zM384 224h256v64h-256V224z m448 64h-128V202.624C704 182.048 687.232 160 640.16 160h-256.32C336.768 160 320 182.048 320 202.624V288H192a32 32 0 1 0 0 64h32V799.968C224 835.296 252.704 864 288.032 864h447.936A64.064 64.064 0 0 0 800 799.968V352h32a32 32 0 1 0 0-64z" p-id="5893" :fill="active === 'trash' ? '#555555' : '#888888'"></path><path d="M608 690.56a32 32 0 0 0 32-32V448a32 32 0 1 0-64 0v210.56a32 32 0 0 0 32 32M416 690.56a32 32 0 0 0 32-32V448a32 32 0 1 0-64 0v210.56a32 32 0 0 0 32 32" p-id="5894" :fill="active === 'trash' ? '#555555' : '#888888'"></path></svg>
      <span :class="{'active': active === 'trash'}">回收站</span>
    </a>
    <el-dialog
      title="文件导入"
      :visible.sync="showImport"
      width="600px">
      <div class="inner-box">
        <el-upload
          class="upload-demo"
          drag
          action=""
          :auto-upload="false"
          :on-change="beforeUpload"
          multiple>
          <i class="el-icon-upload"></i>
          <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
          <div class="el-upload__tip" slot="tip">目前支持的文件类型：*.lf  *.xml</div>
        </el-upload>
      </div>
    </el-dialog>
  </div>
</template>

<script>
import { addGraph } from '../api/index'
export default {
  name: 'leftNav',
  data () {
    return {
      active: 'diagrams',
      showImport: false
    }
  },
  watch: {
  '$route' (to) {
      this.active = to.name
    }
  },
  created () {
    this.active = this.$route.name
  },
  methods: {
    toPage (name) {
      if (this.active !== name) {
        this.$router.push(name)
      }
    },
    newFile (data = {}) {
      addGraph(data).then(res => {
        if (res.status === 200) {
          const graph = res.data.graph
          this.$router.push('diagraming/' + graph.id)
        }
      })
    },
    select (val) {
      console.log(val);
      if (val === 'blankFile') {
        this.newFile({
          types: ['default']
        })
      } else if (val === 'import') {
        this.showImport = true
      } else if (val === 'flowChart') {
        this.newFile({
          types: ['default', 'flowChart']
        })
      } else if (val === 'ERChart') {
        this.newFile({
          types: ['default', 'ERChart']
        })
      } else {
        this.newFile({
          types: ['default', 'UMLChart']
        })
      }
    },
    beforeUpload (file) {
      const reader = new FileReader();
      reader.onload = () => {
        this.newFile({
          info: file.name.includes('.lf') ? JSON.parse(reader.result) : this.$x2js.xml2js(reader.result)
        })
      };
      reader.readAsText(file.raw);
    },
  }
}
</script>

<style lang="less" >
.upload-demo {
  display: flex;
  align-items: center;
  flex-direction: column
}
.inner-box {
  width: 60%;
  margin: 0 auto;
  padding: 12px 0;
}
.el-upload {
  width: 100% !important;
}
.el-upload-dragger {
  width: auto !important;
  height: 220px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  .el-icon-upload {
    margin: 0 0 20px;
  }
}
#left-nav {
  width: 200px;
  flex-shrink: 0;
  margin-top: 30px;
  .new {
    display: flex;
    justify-content: center;
    margin: 0 auto;
    width: 120px;
    line-height: 30px;
    text-align: center;
    background-color: #4386f5;
    color: #FFF;
    border-radius: 4px;
    cursor: pointer;
    caret-color: transparent;
    transform: translateX(4px);
  }
  .item {
    display: flex;
    align-items: center;
    margin-left: 50px;
    cursor: pointer;
    &:last-child {
      margin-right: 14px;
    }
    span {
      margin-left: 8px;
      font-size: 14px;
      line-height: 44px;
      color: #888;
      font-weight: 700;
      caret-color: transparent;
      &.active {
        color: #555;
      }
    }
  }
}
.el-dropdown-menu__item {
  display: flex;
  align-items: center;
  svg {
    margin-right: 12px;
  }
}
.el-dropdown-menu__item:focus, .el-dropdown-menu__item:not(.is-disabled):hover {
  background-color: #eee !important;
  color: #606266 !important;
}
</style>